# MCP 天气服务配置说明

## 配置方式

### 方式一：使用相对路径（推荐，如果工作目录是项目根目录）

在 `src/main/resources/mcp-servers.json` 中：

```json
{
  "mcpServers": {
    "mcp-weather-server": {
      "command": "node",
      "args": [
        "mcp-weather-server/index.js"
      ]
    }
  }
}
```

**前提条件**：Spring Boot 应用启动时，工作目录必须是项目根目录。

### 方式二：使用启动脚本（推荐，更可靠）

1. 使用提供的 `start.sh` 脚本：

```json
{
  "mcpServers": {
    "mcp-weather-server": {
      "command": "bash",
      "args": [
        "mcp-weather-server/start.sh"
      ]
    }
  }
}
```

或者使用绝对路径：

```json
{
  "mcpServers": {
    "mcp-weather-server": {
      "command": "bash",
      "args": [
        "/Users/guomaoyang/IdeaProjects/ai-gmy/mcp-weather-server/start.sh"
      ]
    }
  }
}
```

### 方式三：使用绝对路径（最可靠）

```json
{
  "mcpServers": {
    "mcp-weather-server": {
      "command": "node",
      "args": [
        "/Users/guomaoyang/IdeaProjects/ai-gmy/mcp-weather-server/index.js"
      ]
    }
  }
}
```

**注意**：将 `/Users/guomaoyang/IdeaProjects/ai-gmy` 替换为你的实际项目路径。

### 方式四：使用环境变量（如果支持）

如果 Spring AI MCP 客户端支持环境变量，可以这样配置：

```json
{
  "mcpServers": {
    "mcp-weather-server": {
      "command": "node",
      "args": [
        "${PROJECT_ROOT}/mcp-weather-server/index.js"
      ],
      "env": {
        "PROJECT_ROOT": "/Users/guomaoyang/IdeaProjects/ai-gmy"
      }
    }
  }
}
```

## 当前配置

当前使用的是**方式一**（相对路径），如果遇到路径问题，请尝试：

1. **检查工作目录**：确保 Spring Boot 应用从项目根目录启动
2. **使用方式二**：使用 `start.sh` 脚本（已自动处理路径）
3. **使用方式三**：使用绝对路径（最可靠）

## 验证配置

1. 启动应用后，查看日志：
   ```
   已加载 X 个 MCP 工具
   MCP 工具: get_weather
   ```

2. 如果看到错误，检查：
   - Node.js 是否在 PATH 中
   - 文件路径是否正确
   - 依赖是否已安装（`npm install`）

3. 测试工具：
   ```bash
   curl "http://localhost:7080/mcp/chat?question=查询北京的天气&userId=1"
   ```

## 故障排除

### 问题：找不到文件

**错误信息**：
```
Cannot find module 'mcp-weather-server/index.js'
```

**解决方案**：
1. 使用绝对路径
2. 或使用 `start.sh` 脚本
3. 检查文件是否存在

### 问题：Node.js 未找到

**错误信息**：
```
command not found: node
```

**解决方案**：
1. 安装 Node.js
2. 确保 `node` 在系统 PATH 中
3. 或使用完整路径：`/usr/local/bin/node`

### 问题：依赖未安装

**错误信息**：
```
Cannot find module '@modelcontextprotocol/sdk'
```

**解决方案**：
```bash
cd mcp-weather-server
npm install
```
